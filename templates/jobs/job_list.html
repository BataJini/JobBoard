{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="hero-section">
    <div class="container text-center">
        <h1 class="hero-title">Find Your Next Job</h1>
        <p class="hero-subtitle">Discover opportunities that match your skills and aspirations</p>
        
        <div class="search-container">
            <form id="searchForm" class="search-input-wrapper">
                <div id="searchTags" class="search-tags"></div>
                <input type="text" id="searchInput" class="form-control" placeholder="Search jobs by title, company, or keywords...">
                <button type="submit" class="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>
        
        <div class="hero-tags">
            {% for category in categories %}
                <button class="btn-category" data-category="{{ category.id }}">
                    <i class="{{ category.icon }}"></i>
                    {{ category.name }}
                </button>
            {% endfor %}
        </div>
    </div>
</div>

<div class="content-wrapper">
    <div class="jobs-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h1>Latest Jobs</h1>
                <button class="btn-filters" data-bs-toggle="modal" data-bs-target="#jobFiltersModal">
                    <i class="fas fa-sliders-h me-2"></i>
                    Filters
                </button>
            </div>
        </div>
    </div>

    <div class="jobs-content">
        <div class="job-listings">
            {% for job in jobs %}
                {% include 'jobs/job_listing_snippet.html' with job=job %}
            {% empty %}
                <div class="text-center py-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h3>No jobs found</h3>
                    <p class="text-muted">Try adjusting your search criteria</p>
                </div>
            {% endfor %}
        </div>
        
        {% if is_paginated %}
            <nav class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                        </li>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                            <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                        </li>
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
    </div>
</div>

<!-- Filters Modal -->
<div class="modal fade" id="jobFiltersModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Filter Jobs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="filter-section">
                    <h6 class="filter-section-title">
                        <i class="fas fa-briefcase me-2"></i>
                        Job Type
                    </h6>
                    <div class="d-flex flex-wrap gap-2">
                        {% for type in job_types %}
                            <input type="checkbox" class="btn-check" id="type{{ type.id }}" autocomplete="off">
                            <label class="btn btn-outline-primary" for="type{{ type.id }}">{{ type.name }}</label>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="filter-section">
                    <h6 class="filter-section-title">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        Location
                    </h6>
                    <div class="d-flex flex-wrap gap-2">
                        {% for location in locations %}
                            <input type="checkbox" class="btn-check" id="location{{ location.id }}" autocomplete="off">
                            <label class="btn btn-outline-primary" for="location{{ location.id }}">{{ location.name }}</label>
                        {% endfor %}
                    </div>
                </div>
                
                <div class="filter-section">
                    <h6 class="filter-section-title">
                        <i class="fas fa-dollar-sign me-2"></i>
                        Salary Range
                    </h6>
                    <div class="salary-range-container">
                        <div class="double-range-slider">
                            <div class="slider-track"></div>
                            <div class="slider-handles">
                                <div class="range-handle min-handle" id="minSalaryHandle"></div>
                                <div class="range-handle max-handle" id="maxSalaryHandle"></div>
                            </div>
                            <div class="slider-tooltips">
                                <div class="slider-tooltip min-tooltip" id="minSalaryTooltip">0 PLN</div>
                                <div class="slider-tooltip max-tooltip" id="maxSalaryTooltip">200000 PLN</div>
                            </div>
                            <input type="range" class="slider-input min-input" id="minSalaryRange" min="0" max="200000" value="0" step="1000">
                            <input type="range" class="slider-input max-input" id="maxSalaryRange" min="0" max="200000" value="200000" step="1000">
                        </div>
                        <div class="salary-inputs">
                            <div class="salary-input-group">
                                <label for="minSalaryInput">Min</label>
                                <input type="number" id="minSalaryInput" class="form-control" value="0">
                            </div>
                            <span class="salary-input-divider">-</span>
                            <div class="salary-input-group">
                                <label for="maxSalaryInput">Max</label>
                                <input type="number" id="maxSalaryInput" class="form-control" value="200000">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="applyFiltersBtn" class="btn btn-primary">Apply Filters</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/jobs.js' %}"></script>
<script>
    // Add this script to specifically initialize the salary slider on this page
    document.addEventListener('DOMContentLoaded', function() {
        // Basic slider initialization
        const minRange = document.getElementById('minSalaryRange');
        const maxRange = document.getElementById('maxSalaryRange');
        const minInput = document.getElementById('minSalaryInput');
        const maxInput = document.getElementById('maxSalaryInput');
        const track = document.querySelector('.slider-track');
        const minHandle = document.getElementById('minSalaryHandle');
        const maxHandle = document.getElementById('maxSalaryHandle');
        const minTooltip = document.getElementById('minSalaryTooltip');
        const maxTooltip = document.getElementById('maxSalaryTooltip');
        
        if (minRange && maxRange && track && minHandle && maxHandle) {
            // Format number with thousand separators
            function formatNumber(num) {
                return new Intl.NumberFormat('pl-PL').format(num);
            }
            
            // Update slider visuals based on range values
            function updateSlider() {
                const min = parseInt(minRange.min);
                const max = parseInt(minRange.max);
                const range = max - min;
                
                const minVal = parseInt(minRange.value);
                const maxVal = parseInt(maxRange.value);
                
                // Calculate percentages for positioning
                const minPercent = ((minVal - min) / range) * 100;
                const maxPercent = ((maxVal - min) / range) * 100;
                
                // Position handles
                minHandle.style.left = `${minPercent}%`;
                maxHandle.style.left = `${maxPercent}%`;
                
                // Position tooltips and update their content
                minTooltip.style.left = `${minPercent}%`;
                maxTooltip.style.left = `${maxPercent}%`;
                minTooltip.textContent = `${formatNumber(minVal)} PLN`;
                maxTooltip.textContent = `${formatNumber(maxVal)} PLN`;
                
                // Update track highlighting
                track.style.background = `linear-gradient(to right, 
                    var(--bs-border-color) ${minPercent}%, 
                    #0d6efd ${minPercent}%, 
                    #0d6efd ${maxPercent}%, 
                    var(--bs-border-color) ${maxPercent}%)`;
                
                // Update input fields
                if (minInput) minInput.value = minVal;
                if (maxInput) maxInput.value = maxVal;
            }
            
            // Set up event listeners
            minRange.addEventListener('input', function() {
                const minVal = parseInt(this.value);
                const maxVal = parseInt(maxRange.value);
                
                // Prevent min from exceeding max
                if (minVal > maxVal) {
                    this.value = maxVal;
                }
                
                updateSlider();
            });
            
            maxRange.addEventListener('input', function() {
                const minVal = parseInt(minRange.value);
                const maxVal = parseInt(this.value);
                
                // Prevent max from being less than min
                if (maxVal < minVal) {
                    this.value = minVal;
                }
                
                updateSlider();
            });
            
            // Initialize slider on load
            updateSlider();
        }
    });
</script>
<style>
    /* Ensure slider styling works regardless of external CSS */
    .double-range-slider {
        position: relative;
        height: 50px;
        width: 100%;
        margin: 10px auto;
    }
    
    .slider-track {
        position: absolute;
        width: 100%;
        height: 6px;
        background: #e9ecef;
        border-radius: 3px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 1;
    }
    
    .slider-input {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0;
        z-index: 5;
    }
    
    .min-input {
        z-index: 6;
    }
    
    .range-handle {
        position: absolute;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #0d6efd;
        border: 2px solid #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        top: 50%;
        transform: translate(-50%, -50%);
        cursor: grab;
        z-index: 4;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .min-handle {
        left: 0%;
    }
    
    .max-handle {
        left: 100%;
    }
    
    .slider-tooltip {
        position: absolute;
        background: #0d6efd;
        color: white;
        font-size: 0.75rem;
        padding: 2px 6px;
        border-radius: 3px;
        transform: translateX(-50%);
        transition: opacity 0.2s ease;
        pointer-events: none;
        white-space: nowrap;
        z-index: 10;
    }
    
    .min-tooltip {
        left: 0%;
        opacity: 1;
    }
    
    .max-tooltip {
        left: 100%;
        opacity: 1;
    }
    
    .slider-tooltip:after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 4px solid transparent;
        border-right: 4px solid transparent;
        border-top: 4px solid #0d6efd;
    }
    
    .salary-inputs {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 15px;
    }
    
    .salary-input-group {
        width: 45%;
    }
    
    .salary-input-divider {
        padding: 0 5px;
    }
</style>
{% endblock %} 